# Poc Nx Angular üÖ∞Ô∏è

**See if NX solves my questions/problems in Monorepo Angular:**

- [x] tree shakable libraries (multiple entry points)
- [x] management of dependencies between libs (+tree shakable)
- [x] e2e testing
  - [ ] shared e2e testing
  - [ ] component e2e testing
- [x] Storybook
- [ ] global management of syntax rules and code formatter üëÆ
- [ ] style libraries (SCSS variables, mixings only, theming), publishable
  - [ ] management of libs publication on npm
  - [ ] applications and libraries can they have a version number managed separately ?
- [ ] asset libraries
- [ ] CI with Github Actions (or Gitlab CI/CD)
- [x] NX and Angular update
- [ ] test with another language (React...)
  > It looks compromised since I have initialized an angular monorepo ü§∑
- [ ] distributed NX caching ü§î

Idea of library splitting:

```
üì¶ng-name
 ‚î£ üìÇapps
 ‚îÉ ‚î£ üìÇapp1
 ‚îÉ ‚î£ üìÇapp1-e2e
 ‚îÉ ‚î£ üìÇapp2
 ‚îÉ ‚î£ üìÇapp2-e2e
 ‚îÉ ‚îó üìÇcomponents-e2e
 ‚îÉ ‚îó üìÇ...
 ‚îó üìÇlibs
   ‚î£ üìÇcomponents        // Pure UI shared components (tree shakable, look for Storybook and design system)
   ‚î£ üìÇpipes             // Shared pipes (tree shakable)
   ‚î£ üìÇdirectives        // Shared directives (tree shakable)
   ‚î£ üìÇstyles            // Shared SCSS variables, mixings, theming ü§∑
   ‚î£ üìÇassets            // Shared assets favicon, images, fonts
   ‚î£ üìÇ...
   ‚î£ üìÇfeature1          // A standalone feature lib with own business logic
   ‚î£ üìÇtesting           // Testing helper, like Jest assertion matchers and helpers
   ‚î£ üìÇrxjs              // RXJS lib, like custom operators
   ‚î£ üìÇngrx              // NGRX lib, like serializer, effects, actions
   ‚î£ üìÇtypeguards        // Typescript shared typeguards
   ‚î£ üìÇvalidators        // Angular shared validators
   ‚î£ üìÇapi               // API shared lib (models and services)
   ‚îó üìÇ...
```

## Links

- [Nx and Angular](https://nx.dev/getting-started/nx-and-angular)
- [Angular Plugin](https://nx.dev/angular/overview)
- [Angular Nx Tutorial](https://nx.dev/angular-tutorial/01-create-application)
- https://kevinkreuzer.medium.com/ng-samurai-schematics-to-improve-tree-shaking-of-angular-libraries-83656ca22d9e
- https://medium.com/angular-in-depth/improve-spa-performance-by-splitting-your-angular-libraries-in-multiple-chunks-8c68103692d0
- https://dev.to/kauppfbi_96/why-and-how-to-use-secondary-entrypoints-in-your-angular-libraries-in-nx-3bb2
- https://dev.to/this-is-angular/emulating-tree-shakable-components-using-single-component-angular-modules-13do
- https://www.cypress.io/blog/2022/04/13/share-cypress-commands-in-an-nx-workspace/
- https://github.com/nrwl/nx/issues/3748

## Notes

### Tree shakable libraries

[@nrwl/angular:library-secondary-entry-point](https://nx.dev/angular/library-secondary-entry-point)

Nx distinct three type of libraries: `workspace`, `publishable` and `buildable`.
https://nx.dev/structure/buildable-and-publishable-libraries

> A normal Nx library - let‚Äôs call it "workspace library" - is not made for building or publishing.

Tree shakable libraries , is only compatible with `publishable` or `buildable` libraries, generator need `package.json`.

```bash
nx g @nrwl/angular:lib <lib-name> --buildable
nx g @nrwl/angular:library-secondary-entry-point --library<lib-name> --name=<entry-point-name>
```

### Toolings

**NX running**

```bash
nx [CMD] # Global install  npm install -g nx
npx nx [CMD]
npm run nx [CMD]
npm run ng [CMD]
```

**Runnning**

```bash
npm start
```

**Code formating**

```bash
nx format:write all --base main
nx run-many --target=lint --fix
nx affected:lint --fix
```

**Code linting**

```bash
nx format:check all --base main
nx run-many -- --target=lint
nx affected:lint
```

**Unit testing**

```bash
nx run-many -- --target=test
nx affected:test
```

**End to end testing**

```bash
nx e2e app1-e2e
nx affected:e2e
```

---

```bash
nx storybook [libs-name]
nx storybook components

nx build-storybook components
```

**NX command**

```bash
nx graph
nx affected:graph üòç
nx print-affected --type=app --select=projects
nx workspace-lint
```

## NX Autogenerated DOC

<a href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

‚ú® **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ‚ú®

## Development server

Run `nx serve app` for a dev server. Navigate to http://localhost:4200/. The app will automatically reload if you change any of the source files.

## Understand this workspace

Run `nx graph` to see a diagram of the dependencies of the projects.

## Remote caching

Run `npx nx connect-to-nx-cloud` to enable [remote caching](https://nx.app) and make CI faster.

## Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.

<p style="text-align: center;"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-cloud-card.png"></p>

Nx Cloud pairs with Nx in order to enable you to build and test code more rapidly, by up to 10 times. Even teams that are new to Nx can connect to Nx Cloud and start saving time instantly.

Teams using Nx gain the advantage of building full-stack applications with their preferred framework alongside Nx‚Äôs advanced code generation and project dependency graph, plus a unified experience for both frontend and backend developers.

Visit [Nx Cloud](https://nx.app/) to learn more.

</details>
````
